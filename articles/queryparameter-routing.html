<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Query Parameter Routing </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Query Parameter Routing ">
    <meta name="generator" content="docfx 2.58.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="queryparameter-routing">
<h1 id="query-parameter-based-routing">Query Parameter Based Routing</h1>

<p>Proxy routes specified in <a href="config-files.html">config</a> or via <a href="config-providers.html">code</a> must include at least a path or host to match against. In addition to these, a route can also specify one or more query parameters that must be present on the request.</p>
<h3 id="precedence">Precedence</h3>
<p>The default route match precedence order is 1) path, 2) method, 3) host, 4) headers 5) query parameters. That means a route which specifies methods and no query parameters will match before a route which specifies query parameters and no methods. This can be overridden by setting the <code>Order</code> property on a route.</p>
<h2 id="configuration">Configuration</h2>
<p>Query Parameters are specified in the <code>Match</code> section of a proxy route.</p>
<p>If multiple query parameter rules are specified on a route then all must match for a route to be taken. OR logic must be implemented either within a query parameter rule or as separate routes.</p>
<p>Configuration:</p>
<pre><code class="lang-JSON">&quot;Routes&quot;: {
  &quot;route1&quot; : {
    &quot;ClusterId&quot;: &quot;cluster1&quot;,
    &quot;Match&quot;: {
      &quot;Path&quot;: &quot;{**catch-all}&quot;,
      &quot;QueryParameters&quot;: [
        {
          &quot;Name&quot;: &quot;queryparam1&quot;,
          &quot;Values&quot;: [ &quot;value1&quot; ],
          &quot;Mode&quot;: &quot;Exact&quot;
        }
      ]
    }
  },
  &quot;route2&quot; : {
    &quot;ClusterId&quot;: &quot;cluster1&quot;,
    &quot;Match&quot;: {
      &quot;Path&quot;: &quot;{**catch-all}&quot;,
      &quot;QueryParameters&quot;: [
        {
          &quot;Name&quot;: &quot;queryparam2&quot;,
          &quot;Values&quot;: [ &quot;1prefix&quot;, &quot;2prefix&quot; ],
          &quot;Mode&quot;: &quot;Prefix&quot;
        }
      ]
    }
  },
  &quot;route3&quot; : {
    &quot;ClusterId&quot;: &quot;cluster1&quot;,
    &quot;Match&quot;: {
      &quot;Path&quot;: &quot;{**catch-all}&quot;,
      &quot;QueryParameters&quot;: [
        {
          &quot;Name&quot;: &quot;queryparam3&quot;,
          &quot;Mode&quot;: &quot;Exists&quot;
        }
      ]
    }
  },
  &quot;route4&quot; : {
    &quot;ClusterId&quot;: &quot;cluster1&quot;,
    &quot;Match&quot;: {
      &quot;Path&quot;: &quot;{**catch-all}&quot;,
      &quot;QueryParameters&quot;: [
        {
          &quot;Name&quot;: &quot;queryparam4&quot;,
          &quot;Values&quot;: [ &quot;value1&quot;, &quot;value2&quot; ],
          &quot;Mode&quot;: &quot;Exact&quot;
        },
        {
          &quot;Name&quot;: &quot;queryparam5&quot;,
          &quot;Mode&quot;: &quot;Exists&quot;
        }
      ]
    }
  },
  &quot;route5&quot; : {
    &quot;ClusterId&quot;: &quot;cluster1&quot;,
    &quot;Match&quot;: {
      &quot;Path&quot;: &quot;{**catch-all}&quot;,
      &quot;QueryParameters&quot;: [
        {
          &quot;Name&quot;: &quot;queryparam5&quot;,
          &quot;Values&quot;: [ &quot;value1&quot;, &quot;value2&quot; ],
          &quot;Mode&quot;: &quot;Contains&quot;
        },
        {
          &quot;Name&quot;: &quot;queryparam6&quot;,
          &quot;Mode&quot;: &quot;Exists&quot;
        }
      ]
    }
  },
   &quot;route6&quot; : {
    &quot;ClusterId&quot;: &quot;cluster1&quot;,
    &quot;Match&quot;: {
      &quot;Path&quot;: &quot;{**catch-all}&quot;,
      &quot;QueryParameters&quot;: [
        {
          &quot;Name&quot;: &quot;queryparam6&quot;,
          &quot;Values&quot;: [ &quot;value1&quot;, &quot;value2&quot; ],
          &quot;Mode&quot;: &quot;NotContains&quot;
        },
        {
          &quot;Name&quot;: &quot;queryparam7&quot;,
          &quot;Mode&quot;: &quot;Exists&quot;
        }
      ]
    }
  }
}
</code></pre>
<p>Code:</p>
<pre><code class="lang-C#">var routes = new[]
{
    new RouteConfig()
    {
        RouteId = &quot;route1&quot;,
        ClusterId = &quot;cluster1&quot;,
        Match = new RouteMatch
        {
            Path = &quot;{**catch-all}&quot;,
            QueryParameters = new[]
            {
                new RouteQueryParameter()
                {
                    Name = &quot;QueryParam1&quot;,
                    Values = new[] { &quot;value1&quot; },
                    Mode = QueryParameterMatchMode.Exact
                }
            }
        }
    },
    new RouteConfig()
    {
        RouteId = &quot;route2&quot;,
        ClusterId = &quot;cluster1&quot;,
        Match = new RouteMatch
        {
            Path = &quot;{**catch-all}&quot;,
            QueryParameters = new[]
            {
                new RouteQueryParameter()
                {
                    Name = &quot;QueryParam2&quot;,
                    Values = new[] { &quot;1prefix&quot;, &quot;2prefix&quot; },
                    Mode = QueryParameterMatchMode.Prefix
                }
            }
        }
    },
    new RouteConfig()
    {
        RouteId = &quot;route3&quot;,
        ClusterId = &quot;cluster1&quot;,
        Match = new RouteMatch
        {
            Path = &quot;{**catch-all}&quot;,
            QueryParameters = new[]
            {
                new RouteQueryParameter()
                {
                    Name = &quot;QueryParam3&quot;,
                    Mode = QueryParameterMatchMode.Exists
                }
            }
        }
    },
    new RouteConfig()
    {
        RouteId = &quot;route4&quot;,
        ClusterId = &quot;cluster1&quot;,
        Match = new RouteMatch
        {
            Path = &quot;{**catch-all}&quot;,
            QueryParameters = new[]
            {
            new RouteQueryParameter()
                {
                    Name = &quot;QueryParam4&quot;,
                    Values = new[] { &quot;value1&quot;, &quot;value2&quot; },
                    Mode = QueryParameterMatchMode.Exact
                },
                new RouteQueryParameter()
                {
                    Name = &quot;QueryParam5&quot;,
                    Mode = QueryParameterMatchMode.Exists
                }
            }
        }
    },
    new RouteConfig()
    {
        RouteId = &quot;route5&quot;,
        ClusterId = &quot;cluster1&quot;,
        Match = new RouteMatch
        {
            Path = &quot;{**catch-all}&quot;,
            QueryParameters = new[]
            {
                new RouteQueryParameter()
                {
                    Name = &quot;QueryParam5&quot;,
                    Values = new[] { &quot;value1&quot;, &quot;value2&quot; },
                    Mode = QueryParameterMatchMode.Contains
                }
            }
        }
    },
    new RouteConfig()
    {
        RouteId = &quot;route6&quot;,
        ClusterId = &quot;cluster1&quot;,
        Match = new RouteMatch
        {
            Path = &quot;{**catch-all}&quot;,
            QueryParameters = new[]
            {
                new RouteQueryParameter()
                {
                    Name = &quot;QueryParam6&quot;,
                    Values = new[] { &quot;value1&quot;, &quot;value2&quot; },
                    Mode = QueryParameterMatchMode.NotContains
                }
            }
        }
    }
};
</code></pre>
<h2 id="contract">Contract</h2>
<p><a href="xref:Yarp.ReverseProxy.Configuration.RouteQueryParameter">RouteQueryParameter</a> defines the code contract and is mapped from config.</p>
<h3 id="name">Name</h3>
<p>The query parameter name to check for on the request. A non-empty value is required. This field is case-insensitive.</p>
<h3 id="values">Values</h3>
<p>A list of possible values to search for. The query parameter must match at least one of these values according to the specified <code>Mode</code> except for the 'NotContains'. At least one value is required unless <code>Mode</code> is set to <code>Exists</code>.</p>
<h3 id="mode">Mode</h3>
<p><a href="xref:Yarp.ReverseProxy.Configuration.QueryParameterMatchMode">QueryParameterMatchMode</a> specifies how to match the value(s) against the request query parameter. The default is <code>Exact</code>.</p>
<ul>
<li>Exact - The query parameter must match in its entirety, subject to the value of <code>IsCaseSensitive</code>. Only single query parameters are supported. If there are multiple query parameters with the same name then the match fails.</li>
<li>Prefix - The query parameter must match by prefix, subject to the value of <code>IsCaseSensitive</code>. Only single query parameters are supported. If there are multiple query parameters with the same name then the match fails.</li>
<li>Exists - The query parameter must exist and contain any non-empty value.</li>
<li>Contains - The query parameter must contain the value for a match, subject to the value of <code>IsCaseSensitive</code>. Only single query parameters are supported. If there are multiple query parameters with the same name then the match fails.</li>
<li>NotContains - The query parameter must not contain any of the match values, subject to the value of <code>IsCaseSensitive</code>. Only single query parameters are supported. If there are multiple query parameters with the same name then the match fails.</li>
</ul>
<h3 id="iscasesensitive">IsCaseSensitive</h3>
<p>Indicates if the value match should be performed as case sensitive or insensitive. The default is <code>false</code>, insensitive.</p>
<h3 id="encoding">Encoding</h3>
<p>The request query string will be parsed and decoded before matching against the route rules.</p>
<pre><code>   &quot;route8&quot; : {
    &quot;ClusterId&quot;: &quot;cluster1&quot;,
    &quot;Match&quot;: {
      &quot;Path&quot;: &quot;{**catch-all}&quot;,
      &quot;QueryParameters&quot;: [
        {
          &quot;Name&quot;: &quot;queryparam8&quot;,
          &quot;Values&quot;: [ &quot;another value&quot; ],
          &quot;Mode&quot;: &quot;Exact&quot;
        }
      ]
    }
</code></pre>
<p>Matches to</p>
<pre><code>?queryparam8=another%20value
</code></pre>
<p>or</p>
<pre><code>?queryparam8=another+value
</code></pre>
<h2 id="examples">Examples</h2>
<p>These examples use the configuration specified above.</p>
<h3 id="scenario-1---exact-query-parameter-match">Scenario 1 - Exact Query Parameter Match</h3>
<p>A request with the following query parameter will match against route1.</p>
<pre><code>?QueryParam1=Value1
</code></pre>
<p>Multiple query parameters with the same name are not currently supported and will <em>not</em> match.</p>
<pre><code>?QueryParam1=Value1&amp;QueryParam1=Value2
</code></pre>
<h3 id="scenario-2---multiple-values">Scenario 2 - Multiple Values</h3>
<p>Route2 defined multiple values to search for in a query parameter (&quot;1prefix&quot;, &quot;2prefix&quot;), any of the values are acceptable. It also specified the <code>Mode</code> as <code>Prefix</code>, so any query parameter that starts with those values is acceptable.</p>
<p>Any of the following query parameters will match route2.</p>
<pre><code>?QueryParam2=1prefix
</code></pre>
<pre><code>?QueryParam2=2prefix
</code></pre>
<pre><code>?QueryParam2=1prefix-extra
</code></pre>
<pre><code>?QueryParam2=2prefix-extra
</code></pre>
<p>Multiple query parameters with the same name are not currently supported and will <em>not</em> match.</p>
<pre><code>?QueryParam2=2prefix&amp;QueryParam2=1prefix
</code></pre>
<h3 id="scenario-3---exists">Scenario 3 - Exists</h3>
<p>Route3 only requires that the query parameter &quot;QueryParam3&quot; exists with any non-empty value</p>
<p>The following is an example that will match route3.</p>
<pre><code>?QueryParam3=value
</code></pre>
<p>An empty query parameter will <em>not</em> match.</p>
<pre><code>?QueryParam3
?QueryParam3=
</code></pre>
<p>This mode does support query parameters with multiple values and multiple query parameters with the same name since it does not look at the query parameter contents. The following will match.</p>
<pre><code>?QueryParam3=value1&amp;QueryParam3=value2
</code></pre>
<h3 id="scenario-4---multiple-queryparameters">Scenario 4 - Multiple QueryParameters</h3>
<p>Route4 requires both <code>QueryParam4</code> and <code>QueryParam5</code>, each matching according to their specified <code>Mode</code>. The following query parameters will match route4:</p>
<pre><code>?QueryParam4=value1&amp;QueryParam5=AnyValue
</code></pre>
<pre><code>?QueryParam4=value2&amp;QueryParam5=AnyValue
</code></pre>
<p>These will <em>not</em> match route4 because they are missing one of the required query parameters:</p>
<pre><code>?QueryParam4=value2
</code></pre>
<pre><code>?QueryParam5=AnyValue
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/microsoft/reverse-proxy/blob/release/latest/docs/docfx/articles/queryparameter-routing.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>

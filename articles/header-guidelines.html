<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Header Guidelines </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Header Guidelines ">
    <meta name="generator" content="docfx 2.58.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="header-guidelines">
<h1 id="http-headers">HTTP Headers</h1>

<p>Headers are a very important part of processing HTTP requests and each have their own semantics and considerations. Most headers are proxied by default, though some used to control how the request is delivered are automatically adjusted or removed by the proxy. The connections between the client and the proxy and the proxy and destination are independent, and so headers that affect the connection and transport need to be filtered. Many headers contain information like domain names, paths, or other details that may be affected when a reverse proxy is included in the application architecture. Below is a collection of guidelines about how specific headers might be impacted and what to do about them.</p>
<h2 id="yarp-header-filtering">YARP header filtering</h2>
<p>YARP automatically removes request and response headers that could impact its ability to forward a request correctly, or that may be used maliciously to bypass features of the proxy. A complete list can be found <a href="https://github.com/microsoft/reverse-proxy/blob/v1.0.0-rc.1/src/ReverseProxy/Forwarder/RequestUtilities.cs#L62-L94">here</a>, with some highlights described below.</p>
<h3 id="connection-keepalive-close">Connection, KeepAlive, Close</h3>
<p>These headers control how the TCP connection is managed and are removed to avoid impacting the connection on the other side of the proxy.</p>
<h3 id="transfer-encoding">Transfer-Encoding</h3>
<p>This header describes the format of the request or response body on the wire, e.g. 'chunked', and is removed because the format can vary between the internal and external connection. The incoming and outgoing HTTP stacks will add transport headers as needed.</p>
<h3 id="te">TE</h3>
<p>Only the <code>TE: trailers</code> header value is allowed through the proxy since it's required for some gRPC implementations.</p>
<h3 id="upgrade">Upgrade</h3>
<p>This is used for protocols like WebSockets. It is removed by default and only added back for specifically supported protocols (WebSockets, SPDY).</p>
<h3 id="proxy-">Proxy-*</h3>
<p>These are headers used with proxies and are not considered appropriate to forward.</p>
<h3 id="alt-svc">Alt-Svc</h3>
<p>This response header is used with HTTP/3 upgrades and only applies to the immediate connection.</p>
<h3 id="distributed-tracing-headers">Distributed tracing headers</h3>
<p>These headers include TraceParent, Request-Id, TraceState, Baggage, Correlation-Context. They are automatically removed on .NET 6 or later based on <code>DistributedContextPropagator.Fields</code> so that the forwarding HttpClient can replace them with updated values.
You can opt out of modifying these headers by setting <code>SocketsHttpHandler.ActivityHeadersPropagator</code> to <code>null</code>:</p>
<pre><code class="lang-C#">services.AddReverseProxy()
    .ConfigureHttpClient((_, handler) =&gt; handler.ActivityHeadersPropagator = null);
</code></pre>
<h2 id="other-header-guidelines">Other Header Guidelines</h2>
<h3 id="host">Host</h3>
<p>The Host header indicates which site on the server the request is intended for. This header is removed by default since the host name used publicly by the proxy is likely to differ from the one used by the service behind the proxy. This is configurable using the <a href="transforms.html#requestheaderoriginalhost">RequestHeaderOriginalHost</a> transform.</p>
<h3 id="x-forwarded--forwarded">X-Forwarded-*, Forwarded</h3>
<p>Because a separate connection is used to communicate with the destination, these request headers can be used to forward information about the original connection like the IP, scheme, port, client certificate, etc.. X-Forwarded-For, X-Forwarded-Proto, X-Forwarded-Host, and X-Forwarded-Prefix are enabled by default. This information is subject to spoofing attacks so any existing headers on the request are removed and replaced by default. The destination app should be careful about how much trust it places in these values. See <a href="transforms.html#defaults">transforms</a> for configuring these in the proxy. See the <a href="https://docs.microsoft.com/aspnet/core/host-and-deploy/proxy-load-balancer">ASP.NET docs</a> for configuring the destination app to read these headers.</p>
<h3 id="x-http-method-override-x-http-method-x-method-override">X-http-method-override, x-http-method, x-method-override</h3>
<p>Some clients and servers limit which HTTP methods they allow (GET, POST, etc.). These request headers are sometimes used to work around those restrictions. These headers are proxied by default. If in the proxy you want to prevent these bypasses then use the <a href="transforms.html#requestheaderremove">RequestHeaderRemove</a> transform.</p>
<h3 id="set-cookie">Set-Cookie</h3>
<p>This response header may contain fields constraining the path, domain, scheme, etc. where the cookie should be used. Using a reverse proxy may change the effective domain, path, or scheme of a site from the public view. While it would be possible to <a href="https://github.com/microsoft/reverse-proxy/issues/1109">rewrite</a> response cookies using custom transforms, it's recommended instead to use the Forwarded headers described above to flow the correct values to the destination app so it can generate the correct set-cookie headers.</p>
<h3 id="location">Location</h3>
<p>This response header is used with redirects and may contain a scheme, domain, and path that differ from the public values due to the use of the proxy. While it would be possible to <a href="https://github.com/microsoft/reverse-proxy/discussions/466">rewrite</a> the Location header using custom transforms, it's recommended instead to use the Forwarded headers described above to flow the correct values to the destination app so it can generate the correct Location headers.</p>
<h3 id="server">Server</h3>
<p>This response header indicates what server technology was used to generate the response (IIS, Kestrel, etc.). This header is proxied from the destination by default. Applications that want to remove it can use the <a href="transforms.html#responseheaderremove">ResponseHeaderRemove</a> transform, in which case the proxy's default server header will be used. Suppressing the proxy default server header is server specific, such as for <a href="https://docs.microsoft.com/dotnet/api/microsoft.aspnetcore.server.kestrel.core.kestrelserveroptions.addserverheader#Microsoft_AspNetCore_Server_Kestrel_Core_KestrelServerOptions_AddServerHeader">Kestrel</a>.</p>
<h3 id="x-powered-by">X-Powered-By</h3>
<p>This response header indicates what web framework was used to generate the response (ASP.NET, etc.). ASP.NET Core does not generate this header but IIS can. This header is proxied from the destination by default. Applications that want to remove it can use the <a href="transforms.html#responseheaderremove">ResponseHeaderRemove</a> transform.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/microsoft/reverse-proxy/blob/release/latest/docs/docfx/articles/header-guidelines.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
